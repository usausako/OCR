# 项目说明文档

## 项目简介

本项目用于自动化采集美团等平台竞对门店的相关信息，并将数据写入MySQL数据库。通过自动化操作、OCR识别和数据库管理，实现批量、高效的数据采集与统计。需要下载屏幕共享工具QtScrcpy，并把手机屏幕区域放大到电脑屏幕最右边或可根据自身需求修改相关参数。

---

## 主要功能

- 自动从数据库读取待采集的门店地址和名称
- 自动化输入地址和店名，模拟人工操作
- 截图指定屏幕区域，使用OCR识别目标文本
- 提取店铺评分、销量、配送时间、起送费、配送费、距离、24小时营业、店铺活动、神券活动、24小时下单等信息
- 结果写入MySQL数据库
- 支持断点续采，自动记录和跳过已采集门店
- 支持每日去重，避免重复采集

---

## 依赖环境

- Python 3.x
- 主要依赖库：
  - pyautogui
  - pyperclip
  - opencv-python
  - numpy
  - pillow
  - paddleocr
  - mysql-connector-python

安装依赖（可根据实际情况调整）：

```bash
pip install pyautogui pyperclip opencv-python numpy pillow paddleocr mysql-connector-python
```

---

## 数据库结构

### 配置

在 `end.py` 顶部填写你的数据库配置信息：

```python
DB_CONFIG = {
    'host': '你的数据库地址',
    'user': 'root',
    'password': '你的密码',
    'database': '数据库名',
    'port': 3306
}
```

### 主要表结构

- `竞对门店档案`：存储所有竞对门店的基础信息（如地址、名称、竞对id、门店id）
- `竞对每日统计`：存储每日采集的门店统计数据（如订单量、24小时销量、评分等）

**字段说明（需根据实际表结构补充）：**

- `竞对门店档案`
  - 导航地址
  - 竞对名称
  - 竞对id
  - 门店id

- `竞对每日统计`
  - 日期
  - 竞对id
  - 竞对名称
  - 订单量
  - 24小时销量
  - 距离km
  - 起送价
  - 配送费
  - 店铺评分
  - 神券活动
  - 店铺活动

---

## 主要流程

1. **读取待采集门店**  
   从 `竞对门店档案` 表中读取未采集过的门店信息，排除当天已采集的门店。

2. **自动化输入与搜索**  
   使用 `pyautogui` 自动输入地址和店名，模拟人工操作。

3. **OCR识别与信息提取**  
   截图指定区域，使用 `PaddleOCR` 识别目标文本，提取所需店铺信息。

4. **数据写入数据库**  
   将采集到的信息写入 `竞对每日统计` 表。

5. **断点续采**  
   采集过程中自动记录最后处理的竞对id，支持断点续采。

6. **每日去重**  
   每天只采集一次，避免重复。

---

## 配置说明

- `REGION_COORDS`：屏幕截图区域坐标，需根据实际屏幕调整
- `TARGET_TEXT`：用于判断页面加载完成的目标文本
- `STATE_FILE`：记录最后处理的竞对id的状态文件
- `MAX_PROCESS`：每次最大处理门店数

---

## 使用方法

1. 配置数据库信息和屏幕坐标
2. 确保依赖库已安装
3. 运行脚本：

```bash
python end.py
```

4. 程序会自动处理未采集的门店，采集完成后自动写入数据库
5. 若中途终止，下次运行会自动从上次断点继续

---

## 注意事项

- 需保证程序运行时目标网页已打开并处于正确位置
- 屏幕分辨率、浏览器窗口位置需与 `REGION_COORDS` 匹配
- 数据库表结构需与脚本字段一致
- OCR识别效果受截图清晰度影响，建议使用高清屏幕

---

## 常见问题

- **数据库连接失败**：请检查 `DB_CONFIG` 配置和数据库服务状态
- **OCR识别不准**：可尝试调整截图区域或提升屏幕分辨率
- **自动化输入无效**：请确保无其他窗口遮挡目标输入框

---

如有其他问题或定制需求，请联系开发者。 
